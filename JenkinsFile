node('local-node') {
    stage 'Clone'
    
    dir('coral') {
        git branch: 'master', url: 'ssh://afahd@gerrit.plumgrid.com:29418/coral'
    }
        
    dir('middleware') {
        git branch: 'master', url: 'ssh://afahd@gerrit.plumgrid.com:29418/middle-earth'
        sh 'mkdir -p build; cd build; cmake ..; make install;'
    }
        
       
    stage 'Pipeline'
    withEnv(["WORKSPACE=${pwd()}","JENKINS_BUILDER_SCRIPT_DIR=${pwd()}","JCFG_SKIP_PRE_CLEANUP=1","JCFG_SKIP_POST_CLEANUP=1"]) {
        dir('middleware/build/scripts/devstack')
        {
            sh '$WORKSPACE/jenkins-middleware-devstack-smoke.sh'
        }
    }

}
